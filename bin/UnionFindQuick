#!/usr/bin/env node
const reader = require('readline').createInterface({ input: process.stdin })
const { UnionFindQuick } = require('../js/lib')

/**
 * Union-Find-Quick test client.
 * @see pg.221,224
 */
class UnionFindQuickClient {
  /**
   * Solves dynamic connectivity problem on StdIn.
   *
   * @example <caption>Tiny UF</caption>
   * ```sh
   * $ ./UnionFindQuick < data/tinyUF.txt
   * 4 3
   * 3 8
   * 6 5
   * 9 4
   * 2 1
   * 5 0
   * 7 2
   * 6 1
   * 2 components
   * ```
   *
   * @example <caption>Medium UF</caption>
   * ```sh
   * $ ./UnionFindQuick < data/mediumUF.txt
   * 528 503
   * 548 523
   * 389 414
   * 446 421
   * 552 553
   * ...
   * 3 components
   * ```
   *
   * @example <caption>Large UF</caption>
   * ```sh
   * $ ./UnionFindQuick < data/largeUF.txt
   * 786321 134521
   * 696834 98245
   * 135991 549478
   * 44723 265931
   * 698410 385074
   * ...
   * ??? components # takes too much time
   * ```
   */
  static run() {
    let uf

    reader
      .on('line', (line) => {
        if (!uf) {
          // read firs line to initialize Union-Find-Quick client
          uf = new UnionFindQuick(parseInt(line, 10))
        } else {
          const [p, q] = line.split(' ').map((n) => parseInt(n, 10))

          if (uf.connected(p, q)) {
            // do nothing
          } else {
            uf.union(p, q)
            // NOTE: logging to console is expensive
            // console.log(`${p} ${q}`)
          }
        }
      })
      .on('close', () => {
        console.log(`${uf.count()} components`)
      })
  }

  /**
   * Main execution.
   */
  static main() {
    this.run()
  }
}

UnionFindQuickClient.main()
