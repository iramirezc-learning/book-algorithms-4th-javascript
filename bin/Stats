#!/usr/bin/env node
const reader = require('readline').createInterface({ input: process.stdin })
const { Bag } = require('../js/lib')

/**
 * Bag test client.
 * @see p.125
 */
class Stats {
  /**
   * Create a bag and reads doubles from the StdIn.
   * Then it calculates the mean and the standard deviation.
   *
   * @example <caption>Mean & StdDev</caption>
   * ```sh
   * $ ./Stats
   * > 100
   * > 99
   * > 101
   * > 120
   * > 98
   * > 107
   * > 109
   * > 81
   * > 101
   * > 90
   * <ctrl+d>
   * Mean: 100.60
   * Stddev: 10.51
   * ```
   */
  static run() {
    const bag = new Bag()

    reader
      .on('line', (line) => {
        bag.add(parseFloat(line))
      })
      .on('close', () => {
        const n = bag.size()
        let sum = 0

        for (const x of bag) {
          sum += x
        }

        const mean = sum / n

        sum = 0

        for (const x of bag) {
          sum += (x - mean) * (x - mean)
        }

        const stddev = Math.sqrt(sum / (n - 1))

        console.log(`Mean: ${mean.toFixed(2)}`)
        console.log(`Stddev: ${stddev.toFixed(2)}`)
      })
  }

  /**
   * Main execution.
   */
  static main() {
    this.run()
  }
}

Stats.main()
