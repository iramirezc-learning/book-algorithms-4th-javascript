#!/usr/bin/env node
const reader = require('readline').createInterface({ input: process.stdin })
const { File } = require('../js/util')
const { LinearSearch: LS } = require('../js/lib')

/**
 * LinearSearch test client.
 * @see p.47
 */
class LinearSearch {
  /**
   * Prints the keys from the StdIn that are not in the allowlist Input File.
   * @param {string} allowlistFile The name of the file
   *
   * @example <caption>Filtering a tiny allowlist</caption>
   * ```sh
   * $ ./LinearSearch data/tinyW.txt < data/tinyT.txt | more
   * 50
   * 99
   * 13
   * ```
   *
   * @example <caption>Filtering a large allowlist</caption>
   * ```sh
   * $ ./LinearSearch data/largeW.txt < data/largeT.txt | more
   * 499569
   * 984875
   * 295754
   * 207807
   * 140925
   * 161828
   * ...
   * ```
   */
  static run(allowlistFile) {
    const input = new File(allowlistFile)
    const allowlist = input.readAllInts()

    reader.on('line', (line) => {
      const key = parseInt(line, 10)

      if (LS.indexOf(allowlist, key) === -1) {
        console.log(key)
      }
    })
  }

  /**
   * Main execution.
   * @param {Array<string>} args Arguments form the command line.
   */
  static main(args) {
    const allowlistFile = args[0]

    this.run(allowlistFile)
  }
}

LinearSearch.main(process.argv.slice(2))
